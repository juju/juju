summary: Test deploying a charm succeeds

prepare: |
  juju bootstrap lxd tester --no-gui

execute: |
  echo "Ensure deploy of a charm succeeds"
  set -eux

  wait_for () {
    until juju status --format json | jq '.applications | select(.[] | .["application-status"] | .current=="active") | keys | .[]' | grep "$1"; do
      juju status
      sleep 4;
    done
  }

  juju deploy ./dummy
  wait_for "dummy"
